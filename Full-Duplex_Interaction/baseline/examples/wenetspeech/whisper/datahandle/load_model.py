from transformers import AutoTokenizer, AutoModelForCausalLM
from gxl_ai_utils.utils import utils_file
import os
# os.environ['HF_ENDPOINT']="https://hf-mirror.com"  # 在命令行里面加入就可以了，别的代码完全不用动
# export HF_ENDPOINT=https://hf-mirror.com
#export HF_HOME=/mnt/sfs/asr/ckpt
#export TRANSFORMERS_CACHE=/mnt/sfs/asr/ckpt

# 加载 tokenizer 和模型，并指定 cache_dir 保存模型文件
# model_path = "/home/work_nfs15/asr_data/ckpt/Phi-3.5-mini-instruct/models--microsoft--Phi-3.5-mini-instruct/snapshots/af0dfb8029e8a74545d0736d30cb6b58d2f0f3f0"
model_path ="/mnt/sfs/.cache/huggingface/hub/models--Qwen--Qwen2-7B/snapshots/453ed1575b739b5b03ce3758b23befdb0967f40e"

# model = AutoModelForCausalLM.from_pretrained(model_path, trust_remote_code=True,)
tokenizer = AutoTokenizer.from_pretrained(model_path, trust_remote_code=True,)
res = [[127464, 95295, 43806, 146900, 40744, 89952, 120083, 113991, 147775, 139554, 70315, 72214, 63977, 120813, 151059, 147946, 129958, 33232, 127773, 119373, 52899, 31298, 55688, 55048, 125953, 145281, 118820, 79103, 74893, 127092, 132013, 83890, 88451, 64953, 116353, 13661, 8944, 81259, 127584, 68195, 96727, 128007, 137353, 55086, 81500, 97637, 150177, 68935, 36143, 80531, 121243, 103194, 107009, 46577, 52087, 115035, 22530, 151353, 16765, 100969, 131471, 115845, 91342, 122591, 140884, 94386, 9811, 87480, 41818, 87133, 80655, 12539, 143834, 110070, 111378, 90968, 1735, 62246, 104216, 78052, 40973, 144821, 15411, 18057, 148200, 48772, 18798, 77182, 22823, 56775, 29098, 12189, 65152, 21594, 57351, 19319, 96832, 77038, 140205, 128930, 117316, 127667, 120979, 56935, 83765, 117414, 119602, 128065, 86121, 106878, 55701, 134133, 46880, 53427, 122237, 31181, 32703, 76370, 20881, 47004, 62065, 76589, 111488, 149308, 11692, 75617, 107948, 64693, 64581, 146034, 133728, 81703, 91611, 146958, 59011, 139968, 45595, 35766, 84087, 68376, 71960, 56145, 11185, 151378, 43113, 140560, 140499, 4022, 43908, 36569, 45246, 96365, 63782, 133605, 117410, 123086, 151720, 88298, 10906, 75627, 43843, 61235, 12873, 115776, 136006, 54240, 61198, 51547, 97223, 116142, 60032, 21089, 139591, 118196, 62480, 121700, 146205, 36989, 44949, 138487, 106201, 58062, 150670, 20855, 74708, 136291, 148825, 62897, 75309, 65235, 72870, 49948, 70418, 58188, 135626, 18704, 125346, 55642, 138006, 69524, 23844, 61101, 41214, 112668, 79439, 126791, 20052, 69605, 54612, 110651, 64824, 133078, 85696, 133915, 59183, 93977, 89472, 72210, 138050, 44903, 50314, 69898, 80495, 140242, 29960, 136931, 116897, 3450, 77100, 68216, 138665, 111453, 123844, 141143, 38128, 91092, 45309, 137047, 120263, 8842, 120314, 142225, 43490, 140951, 138937, 38754, 48815, 17099, 90255, 113170, 106995, 65501, 137345, 138797, 133833, 146380, 81228, 60497, 53221, 21863, 114724, 56463, 84580, 98714, 101992, 62073, 90907, 43629, 106967, 83131, 148134, 136326, 128144, 145261, 41163, 17958, 137738, 45847, 146645, 33487, 131722, 69511, 73229, 134371, 96277, 27481, 138877, 145291, 95458, 61381, 33055, 45908, 69100, 93615, 146695, 91179, 142528, 49125, 130645, 80997]]
res = [[127464, 119916, 42470, 13074, 40744, 89952, 120083, 113991, 147775, 139554, 26431, 72214, 63977, 120813, 151059, 147946, 129958, 33232, 127773, 119373, 52899, 31298, 55688, 55048, 125953, 35329, 118820, 79103, 74893, 127092, 10798, 83890, 88451, 64953, 116353, 13661, 8944, 89588, 127584, 68195, 96727, 128007, 137353, 55086, 81500, 97637, 150177, 68935, 36143, 80531, 121243, 103194, 107009, 46577, 52087, 115035, 22530, 151353, 16765, 100969, 131471, 115845, 91342, 122591, 140884, 94386, 9811, 87480, 41818, 87133, 80655, 54994, 143834, 110070, 111378, 90968, 1735, 62246, 104216, 78052, 40973, 144821, 15411, 18057, 148200, 48772, 18798, 77182, 148990, 56775, 29098, 12189, 65152, 21594, 57351, 19319, 96832, 77038, 140205, 128930, 117316, 22835, 120979, 56935, 83765, 117414, 119602, 128065, 86121, 106878, 55701, 134133, 46880, 53427, 122237, 31181, 32703, 76370, 20881, 47004, 62065, 76589, 111488, 149308, 11692, 75617, 107948, 64693, 64581, 146034, 133728, 81703, 91611, 146958, 59011, 139968, 45595, 35766, 84087, 68376, 71960, 56145, 11185, 151378, 43113, 140560, 140499, 4022, 43908, 36569, 45246, 96365, 63782, 133605, 22160, 123086, 151720, 3547, 10906, 75627, 43843, 61235, 12873, 115776, 136006, 54240, 61198, 51547, 97223, 116142, 60032, 21089, 139591, 118196, 62480, 121700, 146205, 36989, 44949, 138487, 106201, 58062, 150670, 20855, 74708, 136291, 148825, 62897, 75309, 65235, 72870, 49948, 70418, 58188, 135626, 98161, 125346, 55642, 138006, 69524, 23844, 61101, 41214, 112668, 79439, 126791, 20052, 69605, 54612, 110651, 64824, 133078, 85696, 133915, 59183, 93977, 89472, 72210, 138050, 44903, 50314, 69898, 60845, 140242, 29960, 136931, 116897, 3450, 77100, 68216, 138665, 111453, 123844, 141143, 38128, 91092, 45309, 137047, 120263, 8842, 120314, 142225, 43490, 140951, 138937, 38754, 48815, 17099, 90255, 113170, 106995, 65501, 137345, 138797, 133833, 146380, 81228, 60497, 53221, 21863, 114724, 56463, 84580, 98714, 101992, 62073, 90907, 43629, 106967, 83131, 148134, 136326, 128144, 145261, 41163, 17958, 137738, 45847, 146645, 33487, 131722, 69511, 73229, 134371, 96277, 27481, 138877, 145291, 95458, 61381, 33055, 45908, 69100, 93615, 146695, 91179, 142528, 49125, 130645, 80997]]
res=[[127464, 119916, 42470, 34690, 40744, 59325, 120083, 113991, 52633, 139554, 578, 47448, 63977, 120813, 151059, 147946, 129958, 33232, 127773, 119373, 52899, 31298, 55688, 55048, 125953, 35329, 118820, 79103, 74893, 127092, 6003, 83890, 88451, 64953, 116353, 13661, 8944, 89588, 127584, 68195, 96727, 128007, 137353, 41863, 81500, 97637, 150177, 68935, 36143, 141697, 121243, 103194, 107009, 46577, 119546, 124531, 22530, 33344, 16765, 100969, 131471, 35137, 91342, 122591, 140884, 94386, 9811, 87480, 78216, 87133, 80655, 54994, 143834, 110070, 111378, 90968, 109719, 62246, 104216, 78052, 40973, 144821, 15411, 18057, 148200, 48772, 18798, 77182, 148990, 56775, 29098, 12189, 65152, 142450, 57351,
    19319, 96832, 77038, 140205, 128930, 117316, 127667, 61932, 56935, 83765, 117414, 119602, 128065, 14566, 106878, 11471, 134133, 46880, 53427, 119303, 144577, 32703, 76370, 20881, 47004, 62065, 76589, 111488, 149308, 11692, 75617, 107948, 64693, 64581, 146034, 57391, 81703, 91611, 146958, 59011, 139968, 45595, 35766, 84087, 68376, 127177, 56145, 11185, 151378, 131427, 140560, 140499, 4022, 43908, 36569, 45246, 96365,
    87265, 133605, 22160, 85299, 151720, 3547, 10906, 75627, 98166, 61235, 12873, 115776, 136006, 10077, 61198, 51547, 97223, 24301, 60032, 21089, 139591, 29851, 62480, 121700, 102033, 36989, 44949, 138487, 148841, 14904, 150670, 20855, 74708, 136291, 148825, 62897, 151618, 65235, 72870, 19663, 70418, 58188, 135626, 32180, 125346, 55642, 138006, 131877, 29269, 61101, 41214, 42902, 79439, 126791, 20052, 69605, 54612, 89188, 64824, 133078, 85696, 133915, 59183, 93977, 89472, 72210, 138050, 44903, 50314, 69898, 80495, 140242, 29960, 136931, 67342, 3450, 77100,
    68216, 106197, 111453, 123844, 141143, 38128, 91092, 45309, 137047, 120263, 8842, 120314, 142225, 43490, 140951, 138937, 38754, 48815, 17099, 90255, 113170, 106995, 65501, 137345, 138797, 133833, 146380, 81228, 60497, 53221, 21863, 114724, 69795, 39471, 98714, 101992, 9532, 90907, 43629, 119507, 18485, 148134, 136326, 128144, 145261, 111478, 53071, 137738, 45847, 146645, 111345, 16512, 69511, 41105, 134371, 96277, 27481, 115949, 145291, 95458, 61381, 33055, 45908, 69100, 98205, 146695, 91179, 142528, 49125, 130645, 80997]]
output_text =tokenizer.batch_decode(res, add_special_tokens=False, skip_special_tokens=True)

print(output_text)
print(tokenizer.eos_token_id)
